<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBOM Play - Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css?v=0.0.3" rel="stylesheet">
    <link href="css/themes.css?v=0.0.3" rel="stylesheet">
    <script src="js/theme-manager.js?v=0.0.3"></script>
    <script src="js/analytics.js?v=0.0.3"></script>
    <script defer data-domain="cyfinoid.github.io" src="https://plausible.io/js/script.outbound-links.js"></script>

</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-cubes me-2"></i>SBOM Play
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="index.html">Home</a>
                <a class="nav-link" href="licenses.html">License</a>
                <a class="nav-link" href="vuln.html">Vulns</a>
                <a class="nav-link" href="audit.html">Audit</a>
                <a class="nav-link" href="deps.html">Deps</a>
                <a class="nav-link" href="repos.html">Repos</a>
                <a class="nav-link" href="authors.html">Authors</a>
                <a class="nav-link" href="about.html">About</a>
                <a class="nav-link active" href="settings.html">Settings</a>
                <button class="btn btn-outline-secondary btn-sm ms-2 theme-toggle" title="Toggle theme">
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1><i class="fas fa-cog me-2"></i>Settings</h1>
                        <p class="text-muted">Manage your SBOM Play configuration and storage</p>
                    </div>
                    <div>
                        <a href="index.html" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Analysis
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Storage Management -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-hdd me-2"></i>Storage Management
                </h5>
            </div>
            <div class="card-body">
                <div id="storageStatus" class="mb-3">
                    <!-- Storage status will be populated by JavaScript -->
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <button class="btn btn-outline-primary btn-sm" data-action="showStorageStatus">
                            <i class="fas fa-info-circle me-2"></i>Check Storage Status
                        </button>
                        <button class="btn btn-outline-info btn-sm" data-action="testStorageQuota">
                            <i class="fas fa-vial me-2"></i>Test Storage
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" data-action="migrateOldData">
                            <i class="fas fa-sync me-2"></i>Migrate Data
                        </button>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-outline-warning btn-sm" data-action="clearOldData">
                            <i class="fas fa-broom me-2"></i>Clear Old Data
                        </button>
                        <button class="btn btn-outline-danger btn-sm" data-action="clearAllData">
                            <i class="fas fa-trash me-2"></i>Clear All Data
                        </button>
                    </div>
                </div>
                
                <hr class="my-3">
                
                <h6 class="mb-3">Export & Import (with Checksum Validation)</h6>
                <div class="alert alert-info mb-3">
                    <i class="fas fa-shield-alt me-2"></i>
                    <strong>Checksum Protection:</strong> All exports include SHA-256 checksums to detect tampering. 
                    Imports automatically verify checksums before importing data.
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6 class="small text-muted mb-2">Export Options</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-success btn-sm" data-action="exportAllData">
                                <i class="fas fa-download me-2"></i>Export All
                            </button>
                            <button class="btn btn-outline-success btn-sm" data-action="exportCachedDatabases">
                                <i class="fas fa-database me-2"></i>Export Cached DBs
                            </button>
                            <button class="btn btn-outline-success btn-sm" data-action="exportAnalysisData">
                                <i class="fas fa-file-export me-2"></i>Export Analysis
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="small text-muted mb-2">Import Options</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-primary btn-sm" data-action="importAllData">
                                <i class="fas fa-upload me-2"></i>Import All
                            </button>
                            <button class="btn btn-outline-primary btn-sm" data-action="importCachedDatabases">
                                <i class="fas fa-database me-2"></i>Import Cached DBs
                            </button>
                            <button class="btn btn-outline-primary btn-sm" data-action="importAnalysisData">
                                <i class="fas fa-file-import me-2"></i>Import Analysis
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="small text-muted mb-2">Individual Cache Exports</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-outline-secondary btn-sm" data-action="exportAuthorsCache">
                                <i class="fas fa-users me-2"></i>Export Authors
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" data-action="exportPackagesCache">
                                <i class="fas fa-box me-2"></i>Export Packages
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" data-action="exportVulnerabilitiesCache">
                                <i class="fas fa-shield-alt me-2"></i>Export Vulnerabilities
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="small text-muted mb-2">Individual Cache Imports</h6>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-outline-secondary btn-sm" data-action="importAuthorsCache">
                                <i class="fas fa-users me-2"></i>Import Authors
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" data-action="importPackagesCache">
                                <i class="fas fa-box me-2"></i>Import Packages
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" data-action="importVulnerabilitiesCache">
                                <i class="fas fa-shield-alt me-2"></i>Import Vulnerabilities
                            </button>
                        </div>
                    </div>
                </div>
                
                <input type="file" id="importFileInput" accept=".json" class="d-none">
            </div>
        </div>

        <!-- Cache Management -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-layer-group me-2"></i>Cache Management
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Global Entity Caches:</strong> These caches store package, author, and vulnerability data shared across all analyses. 
                    Clearing analysis data does not affect these caches, allowing faster re-analysis without re-fetching from APIs.
                </div>
                
                <div id="cacheStats" class="mb-3">
                    <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin me-2"></i>Loading cache statistics...
                    </div>
                </div>
                
                <h6 class="mt-3 mb-2">Entity Caches (Global)</h6>
                <div class="d-flex flex-wrap gap-2 mb-3">
                    <button class="btn btn-outline-secondary btn-sm" data-action="clearCache" data-cache="authors">
                        <i class="fas fa-user-times me-2"></i>Clear Authors Cache
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" data-action="clearCache" data-cache="packages">
                        <i class="fas fa-box me-2"></i>Clear Packages Cache
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" data-action="clearCache" data-cache="vulnerabilities">
                        <i class="fas fa-shield-alt me-2"></i>Clear Vulnerabilities Cache
                    </button>
                    <button class="btn btn-outline-warning btn-sm" data-action="clearCache" data-cache="all">
                        <i class="fas fa-trash-alt me-2"></i>Clear All Entity Caches
                    </button>
                </div>

                <h6 class="mt-3 mb-2">Analysis Data (Organization/Repository Specific)</h6>
                <div class="d-flex flex-wrap gap-2">
                    <button class="btn btn-outline-danger btn-sm" data-action="clearAnalysisData">
                        <i class="fas fa-file-export me-2"></i>Clear Analysis Data Only
                    </button>
                    <small class="text-muted align-self-center ms-2">
                        This clears organization/repository analysis data but keeps entity caches intact.
                    </small>
                </div>
            </div>
        </div>

        <!-- Analysis Settings -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-cog me-2"></i>Analysis Settings</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="maxDepth" class="form-label">Maximum Dependency Depth</label>
                        <input type="number" class="form-control" id="maxDepth" min="1" max="50" value="10">
                        <small class="text-muted">Maximum depth to traverse when resolving dependency trees (default: 10)</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Current Value</label>
                        <div class="p-3 border rounded bg-light">
                            <p class="mb-0"><strong id="currentMaxDepth">10</strong> levels</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <button class="btn btn-primary" id="saveAnalysisSettingsBtn">
                            <i class="fas fa-save me-2"></i>Save Settings
                        </button>
                        <button class="btn btn-outline-secondary" id="resetAnalysisSettingsBtn">
                            <i class="fas fa-undo me-2"></i>Reset to Defaults
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sanctioned Countries Settings -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-ban me-2"></i>Sanctioned Countries
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Compliance Feature:</strong> Configure countries sanctioned by your organization. Authors from these countries will be flagged in the Authors page. 
                    This helps identify potential compliance risks when authors from sanctioned countries contribute to your dependencies.
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Organization Sanctioned Countries</label>
                    <input type="text" id="orgSanctions" class="form-control" placeholder="e.g., CN, RU, BY">
                    <small class="form-text text-muted">
                        Enter ISO 3166-1 alpha-2 country codes separated by commas (e.g., CN, RU, BY). 
                        These will be in addition to USA and UN sanctioned countries.
                    </small>
                </div>
                
                <button class="btn btn-primary" data-action="saveOrgSanctions">
                    <i class="fas fa-save me-2"></i>Save Organization Sanctions
                </button>
                
                <hr class="my-3">
                
                <h6>Current Sanctions</h6>
                <div id="sanctionsStatus">
                    <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin me-2"></i>Loading sanctions status...
                    </div>
                </div>
            </div>
        </div>

        <!-- Author Detection Settings -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-users me-2"></i>Author Detection Settings</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="redoOrgSelect" class="form-label">Redo User Detection for Organization/Repository</label>
                        <select class="form-select" id="redoOrgSelect">
                            <option value="">-- Select an organization or repository --</option>
                        </select>
                        <small class="text-muted">Select an organization or repository to re-run author detection</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Actions</label>
                        <div class="d-flex flex-column gap-2">
                            <button class="btn btn-warning" id="redoAuthorDetectionBtn" disabled>
                                <i class="fas fa-redo me-2"></i>Redo Author Detection
                            </button>
                            <small class="text-muted">This will clear cached author data and re-fetch from APIs</small>
                        </div>
                    </div>
                </div>
                <div id="authorDetectionProgress" class="mt-3 d-none">
                    <div class="mb-2">
                        <strong id="authorDetectionStatus">Preparing...</strong>
                    </div>
                    <div class="progress author-detection-progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated author-detection-progress-bar" 
                             role="progressbar" 
                             id="authorDetectionProgressBar"
                             aria-valuenow="0" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            0%
                        </div>
                    </div>
                    <div id="authorDetectionDetails" class="mt-2 small text-muted"></div>
                </div>
            </div>
        </div>

        <!-- Theme Settings -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-palette me-2"></i>Appearance</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Theme</label>
                        <select class="form-select" id="themeSelect">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                        </select>
                        <small class="text-muted">Choose your preferred color scheme</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Preview</label>
                        <div class="p-3 border rounded bg-secondary">
                            <p class="mb-0 text-primary"><i class="fas fa-cube me-2"></i>SBOM Play Sample Text</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GitHub Token Input -->
        <div class="card mb-4">
            <div class="card-header cursor-pointer" id="tokenSectionHeader">
                <h5 class="mb-0 d-flex justify-content-between align-items-center">
                    <span>
                        <i class="fab fa-github me-2"></i>GitHub Authentication (Optional)
                    </span>
                    <i class="fas fa-chevron-down" id="tokenToggleIcon"></i>
                </h5>
            </div>
            <div class="card-body d-none" id="tokenSectionBody">
                <div class="alert alert-warning alert-sm mb-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Note:</strong> GitHub tokens are not saved or persisted. You will need to provide your token each time you use the application.
                </div>
                <div class="row">
                    <div class="col-md-8">
                        <label for="githubToken" class="form-label">GitHub Personal Access Token (Optional: Provides higher rate limits)<sup>*</sup>&nbsp; <a href="https://github.com/settings/tokens" target="_blank">Create token here</a></label>
                        <input type="password" class="form-control" id="githubToken" 
                               placeholder="ghp_xxxxxxxxxxxxxxxxxxxx (optional)">
                        
                    </div>
                    <div class="col-md-4">
                        <div class="d-flex align-items-end h-100">
                            <button class="btn btn-outline-primary" id="saveTokenBtn">
                                <i class="fas fa-check me-2"></i>Set Token
                            </button>
                        </div>
                    </div>
                </div>
                <div id="tokenStatus" class="mt-2"></div>
            </div>
        </div>

        <!-- Stored Analyses Section -->
        <div id="organizationsSection" class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-database me-2"></i>Stored Analyses
                </h5>
            </div>
            <div class="card-body">
                <div id="organizationsContent">
                    <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <p>Loading stored analyses...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Data Section -->
        <div id="noDataSection" class="card mb-4 d-none">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>No Data Available
                </h5>
            </div>
            <div class="card-body text-center">
                <i class="fas fa-database fa-3x text-muted mb-3"></i>
                <h5>No Stored Analyses Found</h5>
                <p class="text-muted">
                    You haven't analyzed any organizations yet, or all data has been cleared.
                </p>
                <a href="index.html" class="btn btn-primary">
                    <i class="fas fa-play me-2"></i>Start Your First Analysis
                </a>
            </div>
        </div>

        <!-- Rate Limit Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-clock me-2"></i>Rate Limit Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Current Status</h6>
                        <div id="rateLimitStatus">
                            <p class="text-muted">Loading rate limit information...</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Rate Limits</h6>
                        <ul class="list-unstyled">
                            <li><strong>Without token:</strong> 60 requests/hour</li>
                            <li><strong>With token:</strong> 5,000 requests/hour</li>
                            <li>The tool automatically handles rate limiting</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Application Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>Application Information
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>About SBOM Play</h6>
                        <p class="text-muted small">
                            SBOM Play is a client-side tool for analyzing Software Bill of Materials (SBOM) 
                            from GitHub organizations and users. It processes dependency data locally in your browser 
                            and stores results in your browser's local storage.
                        </p>
                        <h6>Key Features:</h6>
                        <ul class="small">
                            <li><strong>Privacy-First:</strong> All processing happens in your browser</li>
                            <li><strong>No Server Required:</strong> Works entirely client-side</li>
                            <li><strong>Persistent Storage:</strong> Results saved in browser storage</li>
                            <li><strong>Rate Limit Aware:</strong> Handles GitHub API limits intelligently</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Browser Compatibility</h6>
                        <ul class="small">
                            <li>Modern browsers with ES6+ support</li>
                            <li>Requires localStorage support</li>
                            <li>No external dependencies</li>
                        </ul>
                        <h6>Data Storage</h6>
                        <ul class="small">
                            <li>All data stored in browser IndexedDB</li>
                            <li>Data persists between browser sessions</li>
                            <li>Generous storage limits (typically 50% of available disk space)</li>
                            <li>Efficient storage for large datasets</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <!-- First Column: SBOM Play Tool -->
                <div class="col-md-4">
                    <h6 class="text-primary">SBOM Play</h6>
                    <p class="text-muted small mb-3">
                        A client-side tool for analyzing Software Bill of Materials from GitHub organizations and users.
                        All processing happens in your browser for maximum privacy and security.
                    </p>
                    <p class="text-muted small mb-0">
                        <strong>Privacy-First:</strong> All processing happens in your browser<br>
                        <strong>No Server Required:</strong> Works entirely client-side<br>
                        <strong>Persistent Storage:</strong> Results saved in browser storage<br>
                        <strong>Rate Limit Aware:</strong> Handles GitHub API limits intelligently
                    </p>
                </div>
                
                <!-- Second Column: Links -->
                <div class="col-md-4">
                    <h6 class="text-primary">Resources</h6>
                    <div class="d-flex flex-column gap-2">
                        <a href="https://cyfinoid.com/" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-globe me-1"></i>Website
                        </a>
                        <a href="https://cyfinoid.com/blog/" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-blog me-1"></i>Blog
                        </a>
                        <a href="https://cyfinoid.com/trainings/#upcoming-trainings" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-graduation-cap me-1"></i>Upcoming Trainings
                        </a>
                        <a href="https://cyfinoid.com/opensource-by-cyfinoid/" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fab fa-github me-1"></i>Open Source by Cyfinoid
                        </a>
                    </div>
                </div>
                
                <!-- Third Column: Company Information -->
                <div class="col-md-4">
                    <h6 class="text-primary">About Cyfinoid Research</h6>
                    <p class="text-muted small mb-3">
                        Leading cybersecurity research company specializing in software supply chain security, 
                        Android security, and cloud security. Our expertise spans across comprehensive software 
                        supply chain protection.
                    </p>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center">
                <small class="text-muted">
                    Â© 2025 Cyfinoid Research. All rights reserved. | 
                    <a href="https://github.com/cyfinoid/sbomplay" target="_blank" class="text-muted">
                        <i class="fab fa-github me-1"></i>View on GitHub
                    </a>
                </small>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/indexeddb-manager.js?v=0.0.3"></script>
    <script src="js/utils.js?v=0.0.3"></script>
    <script src="js/registry-utils.js?v=0.0.3"></script>
    <script src="js/version-utils.js?v=0.0.3"></script>
    <script src="js/ecosystem-utils.js?v=0.0.3"></script>
    <script src="js/cache-manager.js?v=0.0.3"></script>
    <script src="js/github-client.js?v=0.0.3"></script>
    <script src="js/sbom-processor.js?v=0.0.3"></script>
    <script src="js/license-processor.js?v=0.0.3"></script>
    <script src="js/osv-service.js?v=0.0.3"></script>
    <script src="js/author-service.js?v=0.0.3"></script>
    <script src="js/sanctions-service.js?v=0.0.3"></script>
    <script src="js/storage-manager.js?v=0.0.3"></script>
    <script src="js/view-manager.js?v=0.0.3"></script>
    <script src="js/app.js?v=0.0.3"></script>
    <script src="js/settings.js?v=0.0.3"></script>
</body>
</html> 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBOM Play - Data Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-cubes me-2"></i>SBOM Play
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#about">About</a>
                <a class="nav-link" href="index.html">Analysis</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1>üîç SBOM Data Explorer</h1>
                        <p class="text-muted">Explore and navigate through your stored SBOM analyses</p>
                    </div>
                    <div>
                        <a href="index.html" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Analysis
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stored Analyses Section -->
        <div id="organizationsSection" class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-database me-2"></i>Stored Analyses
                </h5>
            </div>
            <div class="card-body">
                <div id="organizationsContent">
                    <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <p>Loading stored analyses...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed View Container -->
        <div id="view-container" style="display: none;">
            <!-- Detailed views will be loaded here -->
            <div class="mb-3">
                <button class="btn btn-outline-secondary" onclick="explorerApp.goBackToResults()">
                    <i class="fas fa-arrow-left me-2"></i>Back to Results
                </button>
            </div>
        </div>

        <!-- No Data Section -->
        <div id="noDataSection" class="card mb-4" style="display: none;">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>No Data Available
                </h5>
            </div>
            <div class="card-body text-center">
                <i class="fas fa-database fa-3x text-muted mb-3"></i>
                <h5>No Stored Analyses Found</h5>
                <p class="text-muted">
                    You haven't analyzed any organizations yet, or all data has been cleared.
                </p>
                <a href="index.html" class="btn btn-primary">
                    <i class="fas fa-play me-2"></i>Start Your First Analysis
                </a>
            </div>
        </div>

        <!-- Cyfinoid Software Supply Chain Security Section -->
        <div class="card mb-4 border-primary">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">
                <i class="fas fa-shield-alt me-2"></i>Software Supply Chain Security Expertise
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h6 class="text-primary">About Cyfinoid Research</h6>
                    <p>
                        SBOM Play is developed by <strong>Cyfinoid Research</strong>, a leading cybersecurity research 
                        company specializing in software supply chain security. Our expertise spans across Android security, 
                        cloud security, and comprehensive software supply chain protection.
                    </p>
                    <p>
                        Software supply chain security is about ensuring the code and tools you rely on‚Äîlike open-source 
                        packages, third-party services, and build pipelines‚Äîhaven't been tampered with. Attackers often 
                        target weak links in the systems you trust rather than your code directly.
                    </p>
                    <div class="alert alert-info">
                        <h6><i class="fas fa-graduation-cap me-2"></i>Professional Training</h6>
                        <p class="mb-2">
                            Cyfinoid offers comprehensive training programs in software supply chain security, including:
                        </p>
                        <ul class="mb-0">
                            <li><strong>Attack & Defend Software Supply Chain</strong> - Hands-on training at major security conferences</li>
                            <li><strong>Attacking CI/CD Pipelines</strong> - Advanced techniques for securing build processes</li>
                            <li><strong>Multi-Cloud Infrastructure Security</strong> - Protecting cloud-native applications</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="mb-3">
                            <i class="fas fa-shield-alt fa-3x text-primary"></i>
                        </div>
                        <h6 class="text-primary">Learn More</h6>
                        <p class="text-muted small">
                            Discover how to secure your software supply chain with professional training and research.
                        </p>
                        <a href="https://cyfinoid.com/software-supply-chain-security/" 
                           target="_blank" 
                           class="btn btn-primary">
                            <i class="fas fa-external-link-alt me-2"></i>Visit Cyfinoid
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- About Section -->
    <div id="about" class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-info-circle me-2"></i>About SBOM Play
            </h5>
        </div>
        <div class="card-body">
            <p>
                SBOM Play is a client-side tool for analyzing Software Bill of Materials (SBOM) 
                from GitHub organizations and users. It processes dependency data locally in your browser 
                and stores results in your browser's local storage.
            </p>
            <h6>Key Features:</h6>
            <ul>
                <li><strong>Privacy-First:</strong> All processing happens in your browser</li>
                <li><strong>No Server Required:</strong> Works entirely client-side</li>
                <li><strong>Persistent Storage:</strong> Results saved in browser storage</li>
                <li><strong>Rate Limit Aware:</strong> Handles GitHub API limits intelligently</li>
            </ul>
            <div class="alert alert-light mt-3">
                <small class="text-muted">
                    <i class="fas fa-code me-1"></i>
                    Developed by <a href="https://cyfinoid.com" target="_blank">Cyfinoid Research</a> - 
                    Leading experts in software supply chain security
                </small>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-primary">SBOM Play</h6>
                    <p class="text-muted small mb-0">
                        A client-side tool for analyzing Software Bill of Materials from GitHub organizations and users.
                        All processing happens in your browser for maximum privacy and security.
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h6 class="text-primary">Developed by Cyfinoid Research</h6>
                    <p class="text-muted small mb-2">
                        Leading experts in software supply chain security, Android security, and cloud security.
                    </p>
                    <div class="d-flex gap-2 justify-content-md-end">
                        <a href="https://cyfinoid.com" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-globe me-1"></i>Website
                        </a>
                        <a href="https://cyfinoid.com/software-supply-chain-security/" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-shield-alt me-1"></i>Supply Chain Security
                        </a>
                    </div>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center">
                <small class="text-muted">
                    ¬© 2025 Cyfinoid Research. All rights reserved. | 
                    <a href="https://github.com/cyfinoid/sbomplay" target="_blank" class="text-muted">
                        <i class="fab fa-github me-1"></i>View on GitHub
                    </a>
                </small>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/github-client.js"></script>
    <script src="js/sbom-processor.js"></script>
    <script src="js/storage-manager.js"></script>
    <script src="js/view-manager.js"></script>
    <script>
        // Simplified app for the explorer view
        class SBOMExplorerApp {
            constructor() {
                this.storageManager = new StorageManager();
                this.viewManager = new ViewManager();
                this.init();
            }

            init() {
                this.displayOrganizationsOverview();
            }

            /**
             * Display organizations overview
             */
            displayOrganizationsOverview() {
                const storageInfo = this.storageManager.getStorageInfo();
                
                if (storageInfo.organizationsCount === 0) {
                    document.getElementById('organizationsSection').style.display = 'none';
                    document.getElementById('noDataSection').style.display = 'block';
                    return;
                }

                const content = document.getElementById('organizationsContent');
                const organizations = storageInfo.organizations;
                
                let html = `
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <h6>Stored Organizations (${organizations.length})</h6>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-outline-primary btn-sm" onclick="explorerApp.exportAllData()">
                                <i class="fas fa-download me-2"></i>Export All
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="explorerApp.clearAllData()">
                                <i class="fas fa-trash me-2"></i>Clear All
                            </button>
                        </div>
                    </div>
                `;

                // Add combined view if there are multiple organizations
                if (organizations.length > 1) {
                    const combinedStats = organizations.reduce((acc, org) => {
                        acc.repositories += org.repositories;
                        acc.dependencies += org.dependencies;
                        return acc;
                    }, { repositories: 0, dependencies: 0 });

                    html += `
                        <div class="alert alert-info mb-3">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="mb-1"><i class="fas fa-layer-group me-2"></i>Combined Analysis</h6>
                                    <p class="mb-0 small">View aggregated data from all ${organizations.length} organizations</p>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-primary btn-sm" onclick="explorerApp.showCombinedView()">
                                        <i class="fas fa-chart-line me-2"></i>View Combined
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                if (organizations.length > 0) {
                    html += `
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Organization</th>
                                        <th>Repositories</th>
                                        <th>Dependencies</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;

                    organizations.forEach(org => {
                        const date = new Date(org.timestamp).toLocaleDateString();
                        const time = new Date(org.timestamp).toLocaleTimeString();
                        
                        html += `
                            <tr>
                                <td><strong>${org.name}</strong></td>
                                <td><span class="badge bg-primary">${org.repositories}</span></td>
                                <td><span class="badge bg-success">${org.dependencies}</span></td>
                                <td><small>${date} ${time}</small></td>
                                <td>
                                    <button class="btn btn-outline-primary btn-sm" onclick="explorerApp.showDetailedViewForOrg('${org.name}')">
                                        <i class="fas fa-eye me-1"></i>View
                                    </button>
                                    <button class="btn btn-outline-info btn-sm" onclick="explorerApp.debugOrganizationData('${org.name}')">
                                        <i class="fas fa-bug me-1"></i>Debug
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="explorerApp.removeOrganizationData('${org.name}')">
                                        <i class="fas fa-trash me-1"></i>Remove
                                    </button>
                                </td>
                            </tr>
                        `;
                    });

                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }

                content.innerHTML = html;
                document.getElementById('organizationsSection').style.display = 'block';
            }

            /**
             * Load organization data
             */
            loadOrganizationData(orgName) {
                const data = this.storageManager.loadAnalysisDataForOrganization(orgName);
                if (data) {
                    // Show detailed view directly
                    this.showDetailedViewForOrg(orgName);
                } else {
                    this.showAlert(`No data found for ${orgName}`, 'warning');
                }
            }

            /**
             * Debug organization data
             */
            debugOrganizationData(orgName) {
                const data = this.storageManager.loadAnalysisDataForOrganization(orgName);
                if (data) {
                    // Show view container
                    document.getElementById('view-container').style.display = 'block';
                    
                    // Show raw data debug view
                    this.viewManager.showRawData(data);
                } else {
                    this.showAlert(`No data found for ${orgName}`, 'warning');
                }
            }

            /**
             * Show detailed view for a specific organization
             */
            showDetailedViewForOrg(orgName) {
                const data = this.storageManager.loadAnalysisDataForOrganization(orgName);
                if (data) {
                    console.log('Loading detailed view for:', orgName, data);
                    
                    // Show view container
                    document.getElementById('view-container').style.display = 'block';
                    
                    // Show organization overview using view manager
                    this.viewManager.showOrganizationOverview(data);
                } else {
                    this.showAlert(`No detailed data found for ${orgName}`, 'warning');
                }
            }

            /**
             * Show combined view from all organizations
             */
            showCombinedView() {
                const combinedData = this.storageManager.getCombinedData();
                if (combinedData) {
                    console.log('Loading combined view:', combinedData);
                    
                    // Show view container
                    document.getElementById('view-container').style.display = 'block';
                    
                    // Show combined organization overview using view manager
                    this.viewManager.showOrganizationOverview(combinedData);
                } else {
                    this.showAlert('No data available for combined view', 'warning');
                }
            }

            /**
             * Remove organization data
             */
            removeOrganizationData(orgName) {
                if (confirm(`Are you sure you want to remove all data for ${orgName}?`)) {
                    const success = this.storageManager.removeOrganizationData(orgName);
                    if (success) {
                        this.showAlert(`Data for ${orgName} has been removed`, 'success');
                        this.displayOrganizationsOverview();
                        
                        // If this was the currently displayed data, clear the view
                        document.getElementById('view-container').style.display = 'none';
                    } else {
                        this.showAlert(`Failed to remove data for ${orgName}`, 'danger');
                    }
                }
            }

            /**
             * Export all data
             */
            exportAllData() {
                const success = this.storageManager.exportAllData();
                if (success) {
                    this.showAlert('All data exported successfully', 'success');
                } else {
                    this.showAlert('Failed to export all data', 'danger');
                }
            }

            /**
             * Clear all data
             */
            clearAllData() {
                if (confirm('Are you sure you want to clear all stored data? This action cannot be undone.')) {
                    const success = this.storageManager.clearAllData();
                    if (success) {
                        this.showAlert('All data cleared successfully', 'success');
                        document.getElementById('view-container').style.display = 'none';
                        document.getElementById('organizationsSection').style.display = 'none';
                        document.getElementById('noDataSection').style.display = 'block';
                    } else {
                        this.showAlert('Failed to clear data', 'danger');
                    }
                }
            }

            /**
             * Show alert
             */
            showAlert(message, type) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                const container = document.querySelector('.container');
                container.insertBefore(alertDiv, container.firstChild);
                
                // Auto-dismiss after 5 seconds
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 5000);
            }
        }

        // Initialize the explorer app
        let explorerApp;
        document.addEventListener('DOMContentLoaded', () => {
            explorerApp = new SBOMExplorerApp();
        });
    </script>
</body>
</html> 
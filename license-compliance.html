<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SBOM Play - License Compliance</title>
    <link href="css/style.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-cubes me-2"></i>SBOM Play
            </a>
            <ul class="nav nav-tabs ms-auto" id="analysisTabs">
                <li class="nav-item">
                    <a class="nav-link active" id="tab-license" href="license-compliance.html">License Compliance</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="tab-vuln" href="vuln.html">Vulnerability Analysis</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="tab-deps" href="deps.html">Dependency Overview</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container mt-4">
        <!-- Stored Analyses Section -->
        <div id="organizationsSection" class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-database me-2"></i>Stored Analyses
                </h5>
            </div>
            <div class="card-body">
                <div id="organizationsContent">
                    <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                        <p>Loading stored analyses...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hidden organization input for analysis -->
        <input type="hidden" id="orgName" value="">
        
        <div id="license-compliance-page">
            <!-- License Compliance content will be rendered here by JS -->
        </div>

        <!-- Cyfinoid Software Supply Chain Security Section -->
        <div class="card mb-4 border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-shield-alt me-2"></i>Software Supply Chain Security Expertise
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h6 class="text-primary">About Cyfinoid Research</h6>
                        <p>
                            SBOM Play is developed by <strong>Cyfinoid Research</strong>, a leading cybersecurity research 
                            company specializing in software supply chain security. Our expertise spans across Android security, 
                            cloud security, and comprehensive software supply chain protection.
                        </p>
                        <p>
                            Software supply chain security is about ensuring the code and tools you rely on‚Äîlike open-source 
                            packages, third-party services, and build pipelines‚Äîhaven't been tampered with. Attackers often 
                            target weak links in the systems you trust rather than your code directly.
                        </p>
                        <div class="alert alert-info">
                            <h6><i class="fas fa-graduation-cap me-2"></i>Professional Training</h6>
                            <p class="mb-2">
                                Cyfinoid offers comprehensive training programs in software supply chain security, including:
                            </p>
                            <ul class="mb-0">
                                <li><strong>Attack & Defend Software Supply Chain</strong> - Hands-on training at major security conferences</li>
                                <li><strong>Attacking CI/CD Pipelines</strong> - Advanced techniques for securing build processes</li>
                                <li><strong>Multi-Cloud Infrastructure Security</strong> - Protecting cloud-native applications</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <div class="mb-3">
                                <i class="fas fa-shield-alt fa-3x text-primary"></i>
                            </div>
                            <h6 class="text-primary">Learn More</h6>
                            <p class="text-muted small">
                                Discover how to secure your software supply chain with professional training and research.
                            </p>
                            <a href="https://cyfinoid.com/software-supply-chain-security/" 
                               target="_blank" 
                               class="btn btn-primary">
                                <i class="fas fa-external-link-alt me-2"></i>Visit Cyfinoid
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Section -->
        <div id="about" class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>About SBOM Play
                </h5>
            </div>
            <div class="card-body">
                <p>
                    SBOM Play is a client-side tool for analyzing Software Bill of Materials (SBOM) 
                    from GitHub organizations and users. It processes dependency data locally in your browser 
                    and stores results in your browser's local storage.
                </p>
                <h6>Key Features:</h6>
                <ul>
                    <li><strong>Privacy-First:</strong> All processing happens in your browser</li>
                    <li><strong>No Server Required:</strong> Works entirely client-side</li>
                    <li><strong>Persistent Storage:</strong> Results saved in browser storage</li>
                    <li><strong>Rate Limit Aware:</strong> Handles GitHub API limits intelligently</li>
                </ul>
                <div class="alert alert-light mt-3">
                    <small class="text-muted">
                        <i class="fas fa-code me-1"></i>
                        Developed by <a href="https://cyfinoid.com" target="_blank">Cyfinoid Research</a> - 
                        Leading experts in software supply chain security
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-primary">SBOM Play</h6>
                    <p class="text-muted small mb-0">
                        A client-side tool for analyzing Software Bill of Materials from GitHub organizations and users.
                        All processing happens in your browser for maximum privacy and security.
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h6 class="text-primary">Developed by Cyfinoid Research</h6>
                    <p class="text-muted small mb-2">
                        Leading experts in software supply chain security, Android security, and cloud security.
                    </p>
                    <div class="d-flex gap-2 justify-content-md-end">
                        <a href="https://cyfinoid.com" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-globe me-1"></i>Website
                        </a>
                        <a href="https://cyfinoid.com/software-supply-chain-security/" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-shield-alt me-1"></i>Supply Chain Security
                        </a>
                    </div>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center">
                <small class="text-muted">
                    ¬© 2025 Cyfinoid Research. All rights reserved. | 
                    <a href="https://github.com/cyfinoid/sbomplay" target="_blank" class="text-muted">
                        <i class="fab fa-github me-1"></i>View on GitHub
                    </a>
                </small>
            </div>
        </div>
    </footer>
    <script src="js/view-manager.js"></script>
    <script src="js/license-processor.js"></script>
    <script src="js/osv-service.js"></script>
    <script src="js/sbom-processor.js"></script>
    <script src="js/storage-manager.js"></script>
    <script src="js/github-client.js"></script>
    <script src="js/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const storageManager = new StorageManager();
        const viewManager = new ViewManager();
        
        // Display organizations overview
        displayOrganizationsOverview();
        
        function displayOrganizationsOverview() {
            const storageInfo = storageManager.getStorageInfo();
            const organizationsContent = document.getElementById('organizationsContent');
            
            if (storageInfo.organizationsCount === 0) {
                organizationsContent.innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-database fa-3x text-muted mb-3"></i>
                        <h5>No Stored Analyses Found</h5>
                        <p class="text-muted">
                            You haven't analyzed any organizations yet, or all data has been cleared.
                        </p>
                        <a href="index.html" class="btn btn-primary">
                            <i class="fas fa-play me-2"></i>Start Your First Analysis
                        </a>
                    </div>
                `;
                return;
            }

            const organizations = storageInfo.organizations;
            
            let html = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Stored Organizations (${organizations.length})</h6>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-outline-primary btn-sm" onclick="exportAllData()">
                            <i class="fas fa-download me-2"></i>Export All
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="clearAllData()">
                            <i class="fas fa-trash me-2"></i>Clear All
                        </button>
                    </div>
                </div>
            `;

            if (organizations.length > 0) {
                html += `
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Organization</th>
                                    <th>Repositories</th>
                                    <th>Dependencies</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                organizations.forEach(org => {
                    const date = new Date(org.timestamp).toLocaleDateString();
                    const time = new Date(org.timestamp).toLocaleTimeString();
                    
                    html += `
                        <tr>
                            <td><strong>${org.name}</strong></td>
                            <td><span class="badge bg-primary">${org.repositories}</span></td>
                            <td><span class="badge bg-success">${org.dependencies}</span></td>
                            <td><small>${date} ${time}</small></td>
                            <td>
                                <button class="btn btn-outline-primary btn-sm" onclick="loadOrganizationData('${org.name}')">
                                    <i class="fas fa-eye me-1"></i>View License Compliance
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="restartLicenseAnalysis('${org.name}')">
                                    <i class="fas fa-redo me-1"></i>Restart Analysis
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="debugOrganizationData('${org.name}')">
                                    <i class="fas fa-bug me-1"></i>Debug
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="removeOrganizationData('${org.name}')">
                                    <i class="fas fa-trash me-1"></i>Remove
                                </button>
                            </td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }

            organizationsContent.innerHTML = html;
        }

        // Load organization data for license compliance
        window.loadOrganizationData = function(orgName) {
            const orgData = storageManager.getOrganizationData(orgName);
            const container = document.getElementById('license-compliance-page');
            
            if (!orgData || !orgData.data) {
                container.innerHTML = '<div class="alert alert-warning">No data found for this organization.</div>';
                return;
            }
            
            // Render license compliance dashboard
            if (typeof viewManager.generateLicenseComplianceHTML === 'function' && orgData.data.licenseAnalysis) {
                container.innerHTML = viewManager.generateLicenseComplianceHTML(orgData);
                if (typeof viewManager.addOverviewEventListeners === 'function') {
                    viewManager.addOverviewEventListeners();
                }
            } else if (orgData.data.licenseAnalysis) {
                container.innerHTML = '<div class="alert alert-warning">This version does not support direct license compliance rendering. Please update your ViewManager.js or use the main app.</div>';
            } else {
                container.innerHTML = '<div class="alert alert-warning">No license compliance analysis found. Please run a license compliance check in the main app.</div>';
            }
        };

        // Debug organization data
        window.debugOrganizationData = function(orgName) {
            const orgData = storageManager.getOrganizationData(orgName);
            const container = document.getElementById('license-compliance-page');
            
            if (orgData) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <h6>üîç Debug Data for ${orgName}</h6>
                        <pre class="bg-light p-3 rounded" style="max-height: 400px; overflow-y: auto;">${JSON.stringify(orgData, null, 2)}</pre>
                    </div>
                `;
            } else {
                container.innerHTML = '<div class="alert alert-warning">No data found for this organization.</div>';
            }
        };

        // Remove organization data
        window.removeOrganizationData = function(orgName) {
            if (confirm(`Are you sure you want to remove all data for ${orgName}?`)) {
                const success = storageManager.removeOrganizationData(orgName);
                if (success) {
                    displayOrganizationsOverview();
                    document.getElementById('license-compliance-page').innerHTML = '<div class="alert alert-info">Please select an organization to view license compliance data.</div>';
                } else {
                    alert('Failed to remove data for ' + orgName);
                }
            }
        };

        // Export all data
        window.exportAllData = function() {
            const success = storageManager.exportAllData();
            if (success) {
                alert('All data exported successfully');
            } else {
                alert('Failed to export all data');
            }
        };

        // Clear all data
        window.clearAllData = function() {
            if (confirm('Are you sure you want to clear all stored data? This action cannot be undone.')) {
                const success = storageManager.clearAllData();
                if (success) {
                    displayOrganizationsOverview();
                    document.getElementById('license-compliance-page').innerHTML = '<div class="alert alert-info">Please select an organization to view license compliance data.</div>';
                } else {
                    alert('Failed to clear data');
                }
            }
        };

        // Start license compliance check
        window.startLicenseComplianceCheck = function() {
            // Show modal for organization input
            const modalHtml = `
                <div class="modal fade" id="licenseCheckModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-shield-alt me-2"></i>License Compliance Check
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Note:</strong> This will redirect you to the main analysis page where you can run a license compliance check.
                                </div>
                                <div class="mb-3">
                                    <label for="orgNameInput" class="form-label">GitHub Organization or User Name</label>
                                    <input type="text" class="form-control" id="orgNameInput" 
                                           placeholder="e.g., microsoft, facebook, torvalds">
                                    <div class="form-text">
                                        Enter a GitHub organization name or username to analyze for license compliance
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-success" onclick="proceedToLicenseCheck()">
                                    <i class="fas fa-shield-alt me-2"></i>Start License Check
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('licenseCheckModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('licenseCheckModal'));
            modal.show();
        };

        // Proceed to license check
        window.proceedToLicenseCheck = function() {
            const orgName = document.getElementById('orgNameInput').value.trim();
            if (!orgName) {
                alert('Please enter an organization or user name.');
                return;
            }
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('licenseCheckModal'));
            modal.hide();
            
            // Redirect to main page with organization pre-filled
            const url = new URL('index.html', window.location.href);
            url.searchParams.set('org', orgName);
            url.searchParams.set('focus', 'license');
            window.location.href = url.toString();
        };

        // Restart license analysis for specific organization
        window.restartLicenseAnalysis = function(orgName) {
            // Set the organization name and start analysis directly
            document.getElementById('orgName').value = orgName;
            app.startAnalysis();
        };

        // Load the most recent organization by default
        const orgs = storageManager.getOrganizations();
        if (orgs && orgs.length > 0) {
            const orgName = orgs[orgs.length - 1].organization;
            loadOrganizationData(orgName);
        } else {
            document.getElementById('license-compliance-page').innerHTML = '<div class="alert alert-info">Please select an organization to view license compliance data.</div>';
        }
    });
    </script>
</body>
</html> 